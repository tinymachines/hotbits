# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Hotbits is a True Random Number Generator (TRNG) project that analyzes sequences of timestamp deltas in nanoseconds generated by natural random processes. The goal is to clean the data stream and generate high-quality random numbers suitable for cryptographic applications.

## Key Commands

### Building the C Programs
```bash
# Build all C programs
make all

# Build specific components
make bin/trng          # GPIO-based timestamp collector
make bin/filter        # Data filtering tool
make bin/rng-extractor # Random number extractor

# Clean build artifacts
make clean

# Install system dependencies (libgpiod for GPIO access)
make install-deps
```

### Running the TRNG Pipeline
```bash
# Collect raw timestamp data from GPIO
./bin/trng > data/raw_timestamps.txt

# Process timestamps into random bytes
./bin/trng | python src/testing/trng_processor.py > data/random.bin

# Run statistical analysis
python src/testing/stats.py < data/events.txt
```

### Python Environment Setup
```bash
# Install Python dependencies
pip install -r requirements.txt

# For development with optional tools
pip install -e ".[dev]"
```

### Testing with NIST STS
```bash
# The project includes NIST Statistical Test Suite in repos/sts-2.1.2/
cd repos/sts-2.1.2/sts-2.1.2/
make
./assess 1000000  # Run tests on 1M bits
```

## Architecture

### Data Flow Pipeline
1. **Hardware Layer**: GPIO pin captures random physical events (e.g., radioactive decay, thermal noise)
2. **Timestamp Collection**: `trng.c` records nanosecond-precision timestamps of events
3. **Processing**: Multiple approaches for extracting randomness:
   - `trng_processor.py`: Median threshold-based bit extraction
   - `filter.c`: Low-level C filtering
   - `xor-groups.c`: XOR-based whitening
4. **Validation**: Statistical test suites (NIST STS, Dieharder) verify randomness quality

### Key Components

#### C Programs (src/testing/)
- `trng.c`: GPIO event timestamp collector using libgpiod
- `filter.c`: Generic data filtering/transformation
- `rng-extractor.c`: Extracts random bits from timestamp streams
- `vomneu.c`: Von Neumann debiasing implementation
- `xor-groups.c`: XOR-based entropy extraction

#### Python Scripts (src/testing/)
- `trng_processor.py`: Main processing pipeline with adaptive thresholding
- `stats.py`: Statistical analysis of timestamp distributions
- `analyze.py`: Data quality analysis
- `gm-analysis.py`: Geometric mean analysis

#### Shell Scripts (src/testing/)
- `pipeline.sh`: Full processing pipeline automation
- `buildit.sh`: Compilation helper
- `stats.sh`: Statistical analysis wrapper

### Data Format
- Raw timestamps: One nanosecond delta per line (text)
- Processed output: Binary stream of random bytes
- Test data: `data/events.txt` contains sample timestamp deltas

## Important Notes

- The TRNG requires physical hardware (GPIO-connected entropy source)
- Calibration phase uses initial samples to determine optimal thresholds
- Multiple debiasing techniques available (Von Neumann, XOR whitening)
- Statistical validation is critical - always test output with NIST STS or Dieharder

## Testing Randomness Quality

```bash
# Generate test data
./bin/trng | python src/testing/trng_processor.py | head -c 1000000 > test.bin

# Run Dieharder tests
dieharder -a -f test.bin

# Run NIST STS (requires compilation first)
cd repos/sts-2.1.2/sts-2.1.2/
./assess 1000000 < ../../../test.bin
```